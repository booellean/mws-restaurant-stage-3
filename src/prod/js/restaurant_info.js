"use strict";var restaurant=void 0,newMap,url=window.location.search,stringID=url.split("?id=")[1],id=parseInt(stringID);function initiateDatabase(){DBHelper.fetchReviews("reviews/?restaurant_id="+id)}function initPage(){fetchRestaurantFromURL()}function initMap(error,restaurant){if(error)console.error(error);else{self.newMap=L.map("map",{center:[restaurant.latlng.lat,restaurant.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiYm9vZWxsZWFuIiwiYSI6ImNqaXo3eHdodDA0YW4zcXBjMjd6dXowZnIifQ.d5RF4w_C9ppt_nAyldHBXQ",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap);var mapBox=document.getElementById("map"),skiplink=document.createElement("a");skiplink.className="skip-link",skiplink.href="#restaurant-container",skiplink.setAttribute("aria-label","Skip link: skip Mapbox map and jump to restaurant content."),skiplink.setAttribute("tabindex","0"),mapBox.prepend(skiplink)}}function fetchRestaurantFromURL(callback){if(self.restaurant)callback(null,self.restaurant);else{var id=getParameterByName("id");id?DBHelper.fetchRestaurantById(id):(error="No restaurant id in URL",callback(error,null))}}function fillFetchedRestaurantFromURL(error,restaurant){self.restaurant=restaurant,restaurant?(fillRestaurantHTML(),initMap(null,restaurant)):console.error(error)}function fillRestaurantHTML(){var restaurant=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,restaurantContainer=document.getElementById("restaurant-container"),divDescript=document.createElement("div");divDescript.setAttribute("aria-label",restaurant.name+" details section. Please Use Arrow Keys to View Items."),divDescript.className="list-item-describor focus-item",observer.observe(restaurantContainer);var favBoolean=restaurant.is_favorite,favWord=void 0,safeName=String(restaurant.name).replace("'","");console.log(safeName);var favorite=document.createElement("button");favorite.className=0==favBoolean||void 0==favBoolean?"star-empty focus-item":"star-full focus-item",favWord=0==favBoolean||void 0==favBoolean?"not Favorite":"Favorite",0==favBoolean||void 0==favBoolean?favorite.setAttribute("data-name","false"):favorite.setAttribute("data-name","true"),favorite.setAttribute("id","button"+restaurant.id),favorite.setAttribute("aria-label","Toggle Favorites: "+restaurant.name+" is currently "+favWord),favorite.setAttribute("onclick","DBHelper.toggleFavorite("+restaurant.id+", '"+safeName+"', event)"),restaurantContainer.prepend(favorite),restaurantContainer.prepend(divDescript);var name=document.getElementById("restaurant-name");name.innerHTML=restaurant.name,name.className="focus-item lazy-load";var address=document.getElementById("restaurant-address");address.innerHTML=restaurant.address,address.className="focus-item lazy-load";var image=document.getElementById("restaurant-img");image.className="focus-item restaurant-img lazy-load",image.setAttribute("alt",restaurant.alt),image.setAttribute("id",restaurant.id);var cuisine=document.getElementById("restaurant-cuisine");cuisine.innerHTML=restaurant.cuisine_type,cuisine.className="focus-item lazy-load";var reviewForm=document.getElementById("form-container"),divDescriptTwo=document.createElement("div");divDescriptTwo.setAttribute("aria-label",restaurant.name+" review form. Please describe your experience at this restaurant."),divDescriptTwo.setAttribute("tabindex","0"),divDescriptTwo.className="list-item-describor";var skiplink=document.createElement("a");skiplink.className="skip-link",skiplink.href="#footer",skiplink.setAttribute("aria-label","Skip link: skip form section"),skiplink.setAttribute("tabindex","0"),reviewForm.prepend(skiplink),reviewForm.prepend(divDescriptTwo),restaurant.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fillReviewsHTML(restaurant.id,null)}function fillRestaurantHoursHTML(){var operatingHours=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,hours=document.getElementById("restaurant-hours");for(var key in observer.observe(hours),operatingHours){var row=document.createElement("tr");row.className="lazy-load";var day=document.createElement("td");day.innerHTML=key,day.className="focus-item",row.appendChild(day);var time=document.createElement("td");time.innerHTML=operatingHours[key],time.className="focus-item",row.appendChild(time),hours.appendChild(row)}}function fillReviewsHTML(){var reviews=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.review,container=document.getElementById("reviews-container"),divDescript=document.createElement("div");divDescript.setAttribute("aria-label","Review Information. Please tab over and use arrow keys to cycle through content"),divDescript.className="list-item-describor focus-item",container.prepend(divDescript),observer.observe(container);var title=document.createElement("h3");if(title.innerHTML="Reviews",title.className="focus-item lazy-load",container.appendChild(title),!reviews){var noReviews=document.createElement("p");return noReviews.innerHTML="No reviews yet!",noReviews.className="focus-item lazy-load",void container.appendChild(noReviews)}var ul=document.getElementById("reviews-list");reviews.forEach(function(review){ul.appendChild(createReviewHTML(review))}),container.appendChild(ul),restaurantObjects()}function createReviewHTML(review){var li=document.createElement("li"),name=document.createElement("p");name.innerHTML=review.name,name.className="focus-item lazy-load",li.appendChild(name),observer.observe(li);var date=document.createElement("p");date.innerHTML=review.createdAt,date.className="focus-item lazy-load",li.appendChild(date);var rating=document.createElement("p");rating.innerHTML="Rating: "+review.rating,rating.className="focus-item lazy-load",li.appendChild(rating);var comments=document.createElement("p");return comments.innerHTML=review.comments,comments.className="focus-item lazy-load",li.appendChild(comments),li}function fillBreadcrumb(){var restaurant=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self.restaurant,breadcrumb,breadcrumbUL=document.getElementById("breadcrumb").querySelector("ul"),li=document.createElement("li");li.innerHTML=restaurant.name,li.setAttribute("tabindex","0"),li.setAttribute("aria-current","page"),breadcrumbUL.appendChild(li)}function getParameterByName(name,url){url||(url=window.location.href),name=name.replace(/[\[\]]/g,"\\$&");var regex,results=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)").exec(url);return results?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}function submitReview(e){var name=document.querySelector("#name").value,rating=parseInt(document.querySelector("#rating").value),comments=document.querySelector("#comments").value,time=Math.round((new Date).getTime()/1e3),review={restaurant_id:id,name:name,createdAt:time,updatedAt:time,rating:rating,comments:comments};DBHelper.submitReview(review),e.preventDefault()}window.addEventListener("load",initiateDatabase);